"use strict";(this["webpackChunktzw_live_watch"]=this["webpackChunktzw_live_watch"]||[]).push([[627],{41127:(e,t,o)=>{o.r(t),o.d(t,{default:()=>L});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"root-container",style:e.getLiveRoomStyle.mainStyle||{}},[t("Header",{attrs:{multiRoomFlag:""}}),t("div",{staticClass:"frame-container"},[e._l(e.roomList,function(o,i){return t("iframe",{key:"sub_room_"+i,staticClass:"frame-panel",attrs:{src:o.url,onload:"multiRoomSmgFramesloded(this)"}},[t("H2",[e._v("直播间无法访问")])],1)}),t("div",{ref:"videoContainer",staticClass:"video-container"},[!e.getLiveStateInfo.active&&e.getLiveRoomTheme.warmImg&&/\.[Mm][Pp]4$/g.test(e.getLiveRoomTheme.warmImg)?t("video",{staticClass:"video-warm-img",attrs:{src:e.getLiveRoomTheme.warmImg,autoplay:"",loop:""}}):e._e(),e.getLiveStateInfo.active||!e.getLiveRoomTheme.warmImg||/\.[Mm][Pp]4$/g.test(e.getLiveRoomTheme.warmImg)?e._e():t("img",{staticClass:"video-warm-img",attrs:{src:e.getLiveRoomTheme.warmImg}}),["webrtc","whep"].indexOf(e.getLiveRoomInfo.liveStreamSupplier)>=0&&e.getLiveStateInfo.active?t("div",{ref:"videoPanel",staticClass:"video-panel"},[t("video",{attrs:{id:"videoPlayer",controls:"",autoplay:""}})]):e.getLiveStateInfo.active?t("div",{ref:"videoPanel",staticClass:"video-panel"},[e.getLiveStateInfo.active?t("iframe",{ref:"videoPlayerFrame",staticClass:"video-play-frame",attrs:{id:"video-play-frame",src:"/video.html"}}):e._e()]):e._e()])],2)],1)},s=[],n=(o(44114),o(18111),o(7588),o(95353)),r=o(55373),a=o.n(r),m=o(30085),l=o(93756),c=o(31428),g=o(46197),u=o(52112);const v={name:"MultiRoomMsg",components:{Header:m.A},computed:{...(0,n.L8)(["getToken","getLiveRoomInfo","getLiveRoomTheme","getLiveRoomStyle","getLiveStateInfo","getUserInfo","isMobile","getBaseUrlObj","getLoginInfo","getMultiRoomUserInfo","getClientInfo"])},watch:{"$store.state.isMobile":function(e){this.myMobile=e},getToken(e){e||"login"!=this.$route.name&&this.$router.push({name:"login"})}},data(){return{myMobile:void 0,roomList:[],checkWsStatusTimer:null,checkLiveRoomStatusTimer:null}},mounted(){let e=this;e.BUS.updatePlayer=e.updatePlayer,e.$nextTick(()=>{e.roomList=e.getRooms(),e.initPlayer()}),this.$store.commit("clearEveryThing");let t=e.getBaseUrlObj;const o=()=>{if(e.checkWsStatusTimer&&clearTimeout(e.checkWsStatusTimer),(0,c.zS)()<1)if(t&&!(0,u.Im)(t.wsURL))(0,c.E_)(t.wsURL,e.getToken,e.getLiveRoomInfo.id);else{let t=window.location.protocol+"//"+window.location.host,o=t.replace(/^http/g,"ws").replace(/[\/]*$/g,"/ws/websocket");(0,c.E_)(o,e.getToken,e.getLiveRoomInfo.id)}e.checkWsStatusTimer=setTimeout(o,3e3)};o();let i=0;const s=()=>{const t={roomId:e.getLiveRoomInfo.id,userId:e.getUserInfo.userId,userName:e.getUserInfo.userName,token:e.getToken,channelCode:e.getLiveRoomInfo.channelCode,wsSessionType:e.isMobile?"APP_LIVE_ROOM":"PC_LIVE_ROOM"};console.log(t),(0,l.kk)(t).then(t=>{1!=t.data?(console.error("直播间不可访问"),i>=120?(clearTimeout(e.checkLiveRoomStatusTimer),clearTimeout(e.checkWsStatusTimer),setTimeout(()=>{e.$store.dispatch("LogOut").then(()=>{location.href="/index"})},3e3)):(i++,clearTimeout(e.checkLiveRoomStatusTimer),e.checkLiveRoomStatusTimer=setTimeout(s,3e4))):(i=0,e.checkLiveRoomStatusTimer=setTimeout(s,3e4))}).catch(t=>{console.error("直播间不可访问",t),i>=120?(clearTimeout(e.checkLiveRoomStatusTimer),clearTimeout(e.checkWsStatusTimer),setTimeout(()=>{e.$store.dispatch("LogOut").then(()=>{location.href="/index"})},3e3)):(i++,clearTimeout(e.checkLiveRoomStatusTimer),e.checkLiveRoomStatusTimer=setTimeout(s,3e4))})};e.checkLiveRoomStatusTimer=setTimeout(s,3e3)},beforeUnmount(){clearTimeout(this.checkWsStatusTimer),clearTimeout(this.checkLiveRoomStatusTimer)},methods:{getRooms(){let e=[],t=this;if(t.getUserInfo&&t.getLoginInfo&&Object.keys(t.getLoginInfo)&&Object.keys(t.getLoginInfo).length&&t.getLiveRoomInfo&&t.getLiveRoomInfo.multiRooms&&t.getLiveRoomInfo.multiRooms.length){let i={username:t.getLoginInfo.username&&"undefined"!=t.getLoginInfo.username&&"null"!=t.getLoginInfo.username?t.getLoginInfo.username:"",password:t.getLoginInfo.password&&"undefined"!=t.getLoginInfo.password&&"null"!=t.getLoginInfo.password?t.getLoginInfo.password:"",type:t.getUserInfo.type,loginType:this.isMobile?5:2,multi:!0},s=a().stringify(i);var o=window.location.protocol+window.location.host;let n={url:o};n.url=n.url+(n.url.indexOf("?")>0?"&":"?")+s,e.push(n),t.getLiveRoomInfo.multiRooms.forEach(t=>{let o={...t};o.url=o.url+(o.url.indexOf("?")>0?"&":"?")+s,e.push(o)})}return e},initPlayer(){(0,l.HE)({channelCode:this.getLiveRoomInfo.channelCode}).then(e=>{let t=e;this.$store.dispatch("setLiveStateInfo",t)})},updatePlayer(e,t,o,i,s,n,r,a){let m=this;this.$nextTick(()=>{setTimeout(()=>{if(["webrtc","whep"].indexOf(this.getLiveRoomInfo.liveStreamSupplier)>=0)(0,g.UX)(o,e,t,this.getLiveRoomTheme.warmImg,s,n,r,this.getLiveRoomInfo.id,this.getUserInfo.userName,this.getToken,this.turnServerConf,a,this.getLiveRoomInfo.extValue,this.getLiveRoomInfo.liveStreamLicenseUrl);else if(o){let i=m.$refs.videoPlayerFrame;if(i){let l=i.contentWindow;l&&setTimeout(()=>{const i="&channelCode="+m.getLiveRoomInfo.channelCode+"&roomId="+m.getLiveRoomInfo.id+"&userName="+m.getUserInfo.userName;e+=i,t+=i,l.postMessage({cmd:"initPlayer",args:{active:o,url:e,rtsUrl:t,roomId:this.getLiveRoomInfo.id,userName:this.getUserInfo.userName,token:this.getToken,turnServerConf:this.turnServerConf,wormImg:this.getLiveRoomTheme.warmImg,channelId:s,channelCode:n,liveList:r,isUpdateUrl:a,extValue:this.getLiveRoomInfo.extValue,liveStreamLicenseUrl:this.getLiveRoomInfo.liveStreamLicenseUrl}},"*"),l.postMessage({cmd:"setVideoStyle",args:{objectFit:"contain"}},"*"),window.removeEventListener("message",g.e6),window.addEventListener("message",g.e6,!1)},300)}}else{let e=m.$refs.videoPlayerFrame;if(e){let t=e.contentWindow;t&&(t.postMessage({cmd:"destroyPlayer"},"*"),window.removeEventListener("message",g.e6))}}},200)})}}},h=v;var d=o(81656),f=(0,d.A)(h,i,s,!1,null,"ea67998a",null);const L=f.exports}}]);